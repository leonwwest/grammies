<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grammar Games ‚Äì Altersgruppe w√§hlen</title>

  <link rel="stylesheet" href="shared.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --gg-orange:#FF6B6B;
      --gg-orange-dark:#ff5a5a;
      --gg-border:rgba(255,255,255,.55);
      --gg-shadow:0 12px 30px rgba(26, 26, 44, .22);
    }
    body{
      font-family:"Poppins",system-ui,Segoe UI,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #b9c6ff33, #0000),
                  radial-gradient(1000px 600px at 90% -10%, #a2b3ff30, #0000),
                  linear-gradient(135deg,#89a6ff 0%, #bba8ff 50%, #d0b7ff 100%);
      min-height:100vh;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      color:#0f172a;
    }

    /* ===== Topbar (matching games/preview) ===== */
    .gg-topbar{
      display:flex; align-items:center; gap:12px;
      padding:14px 18px; position:sticky; top:0; z-index:1050;
      backdrop-filter:saturate(140%) blur(8px);
    }
    .gg-flex-spacer{ flex:1; }
    .gg-btn{
      display:inline-flex; align-items:center; gap:.5rem;
      height:38px; padding:0 14px; border-radius:22px;
      font:600 14px/1.1 "Poppins",system-ui,Segoe UI,Arial,sans-serif;
      text-decoration:none; cursor:pointer; user-select:none;
      transition:.18s ease; border:1.5px solid transparent; color:#fff;
    }
    .gg-primary{ background:var(--gg-orange); border-color:var(--gg-orange); box-shadow:0 6px 18px rgba(255,107,107,.28); }
    .gg-primary:hover{ transform:translateY(-1px); background:var(--gg-orange-dark); }
    .gg-ghost{ background:transparent; color:#fff; border-color:var(--gg-border); }
    .gg-ghost:hover{ background:rgba(255,255,255,.10); }
    .gg-lang.gg-active{ background:var(--gg-orange); color:#fff; border-color:var(--gg-orange); box-shadow:0 6px 18px rgba(255,107,107,.28); }
    .gg-back{ margin-right:8px; }

    /* ===== Page layout ===== */
    .wrap{ max-width:1200px; margin:0 auto; padding:0 18px 64px; }
    .title{ text-align:center; color:#fff; font-size:clamp(28px,3.4vw,40px); font-weight:800; margin:14px 0 6px; }
    .sub{ text-align:center; color:#eef; opacity:.98; margin:0 0 26px; }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:24px; }
    @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }

    .age-card{
      background:#fff;
      border-radius:24px; padding:28px 26px;
      box-shadow:0 28px 60px rgba(0,0,0,.14);
      border:1px solid rgba(255,255,255,.55);
      transition:.18s ease;
      cursor:pointer;
    }
    .age-card:hover{ transform:translateY(-2px); box-shadow:0 36px 70px rgba(0,0,0,.16); }
    .age-title{ font-size:clamp(24px,2.6vw,34px); margin:0 0 6px; color:#0f172a; font-weight:800; letter-spacing:.2px; }
    .age-desc{ margin:0 0 14px; color:#6b7280; font-weight:600; }

    .list{ margin:10px 0 0; padding:0; list-style:none; }
    .list li{ display:flex; align-items:center; gap:10px; padding:8px 0; color:#334155; }
    .list li .emoji{ width:24px; text-align:center; }

    /* tiny feedback toast */
    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      background:rgba(255,255,255,.95); color:#111827; padding:10px 14px;
      border-radius:999px; border:1px solid rgba(0,0,0,.06); box-shadow:0 10px 30px rgba(0,0,0,.18);
      display:none; z-index:1200;
    }
  </style>

  <script src="language.js"></script>
</head>
<body>

  <!-- Topbar -->
  <div class="gg-topbar">
    <a class="gg-btn gg-primary gg-back back-link" href="#">
      <span class="arrow">‚Üê</span>
      <span class="back-text" data-translate="backButton">Zur√ºck</span>
    </a>

    <div class="gg-flex-spacer"></div>

    <a class="gg-btn gg-ghost gg-lang lang-link" data-lang="de" href="#">Deutsch</a>
    <a class="gg-btn gg-ghost gg-lang lang-link" data-lang="zh" href="#">‰∏≠Êñá</a>
  </div>

  <div class="wrap">
    <h1 class="title" data-translate="chooserTitle">Wie alt ist Ihr Kind?</h1>
    <p class="sub" data-translate="chooserSubtitle">Wir zeigen Ihnen die passenden Grammar Games</p>

    <div class="grid">
      <!-- 4‚Äì6 -->
      <article class="age-card" data-age="4-6" tabindex="0" role="button" aria-label="4‚Äì6 Jahre ausw√§hlen">
        <h2 class="age-title" data-translate="age46Title">4‚Äì6 Jahre</h2>
        <div class="age-desc" data-translate="age46Desc">Spielerische Grundlagen</div>
        <ul class="list">
          <li><span class="emoji">üê±</span><span data-translate="ex1a">Tier-W√∂rter sortieren</span></li>
          <li><span class="emoji">üåà</span><span data-translate="ex1b">Farben-Adjektive</span></li>
          <li><span class="emoji">üèÉ‚Äç‚ôÄÔ∏è</span><span data-translate="ex1c">Action-Verben</span></li>
        </ul>
      </article>

      <!-- 7‚Äì10 -->
      <article class="age-card" data-age="7-10" tabindex="0" role="button" aria-label="7‚Äì10 Jahre ausw√§hlen">
        <h2 class="age-title" data-translate="age710Title">7‚Äì10 Jahre</h2>
        <div class="age-desc" data-translate="age710Desc">Strukturierte Grammatik</div>
        <ul class="list">
          <li><span class="emoji">üß©</span><span data-translate="ex2a">S√§tze konstruieren</span></li>
          <li><span class="emoji">‚ö°</span><span data-translate="ex2b">Zeit-Formen-Quiz</span></li>
          <li><span class="emoji">üî§</span><span data-translate="ex2c">Wortarten-Memory</span></li>
        </ul>
      </article>
    </div>
  </div>

  <div class="toast" id="toast">‚úî Auswahl √ºbernommen ‚Ä¶</div>

  <script src="analytics.js"></script>
  <script>
    (function(){
      const VARIANT = 'A'; // fixed
      const qs = new URLSearchParams(location.search);
      const LANG = (qs.get('lang') || window.languageSystem?.currentLanguage || localStorage.getItem('grammarGamesLanguage') || 'de').toLowerCase();

      /* 1) Apply translations */
      try {
        if (window.setLanguageFromQuery) window.setLanguageFromQuery(LANG);
        else if (window.languageSystem?.applyTranslations) {
          window.languageSystem.currentLanguage = LANG;
          window.languageSystem.applyTranslations();
        }
      } catch(_) {}

      /* 1b) Fallback to German text if chooser keys are missing */
      const fallbacks = {
        chooserTitle: 'Wie alt ist Ihr Kind?',
        chooserSubtitle: 'Wir zeigen Ihnen die passenden Grammar Games',
        age46Title: '4‚Äì6 Jahre',
        age46Desc: 'Spielerische Grundlagen',
        ex1a: 'Tier-W√∂rter sortieren',
        ex1b: 'Farben-Adjektive',
        ex1c: 'Action-Verben',
        age710Title: '7‚Äì10 Jahre',
        age710Desc: 'Strukturierte Grammatik',
        ex2a: 'S√§tze konstruieren',
        ex2b: 'Zeit-Formen-Quiz',
        ex2c: 'Wortarten-Memory'
      };
      try {
        const t = (k)=> window.languageSystem?.t?.(k) || k;
        document.querySelectorAll('[data-translate]').forEach(el=>{
          const k = el.getAttribute('data-translate');
          if (t(k) === k && fallbacks[k]) el.innerHTML = fallbacks[k];
        });
      } catch(_){}

      /* 2) Back ‚Üí preview.html with params + tracking */
      document.querySelectorAll('.back-link').forEach(a=>{
        const u = new URL('preview.html', location.href);   // go back to preview
        u.searchParams.set('variant', VARIANT);
        u.searchParams.set('lang', LANG);
        a.href = u.pathname + '?' + u.searchParams.toString();
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          if (window.navigateWithTracking) {
            window.navigateWithTracking(a.href, 'chooser-back-to-preview');
            setTimeout(()=> location.href = a.href, 150);
          } else {
            location.href = a.href;
          }
        });
      });

      /* 3) Language links keep params + active state */
      document.querySelectorAll('.lang-link').forEach(a=>{
        const L = a.dataset.lang;
        const url = new URL(location.href);
        url.searchParams.set('lang', L);
        url.searchParams.set('variant', VARIANT);
        a.href = url.pathname + '?' + url.searchParams.toString();
        a.classList.toggle('gg-active', L === LANG);
      });

      /* 4) Age card click ‚Üí toast + redirect to capture.html?age= */
      const toast = document.getElementById('toast');
      function showToast(msg){
        toast.textContent = msg || '‚úî Auswahl √ºbernommen ‚Ä¶';
        toast.style.display = 'block';
        setTimeout(()=> toast.style.display = 'none', 1200);
      }

      document.querySelectorAll('.age-card').forEach(card=>{
        function go(){
          const age = card.dataset.age;
          showToast('‚úî Auswahl √ºbernommen ‚Ä¶');
          const u = new URL('capture.html', location.href);
          u.searchParams.set('age', age);
          u.searchParams.set('variant', VARIANT);
          u.searchParams.set('lang', LANG);
          const href = u.pathname + '?' + u.searchParams.toString();
          if (window.navigateWithTracking) {
            window.navigateWithTracking(href, 'chooser-to-capture', { age });
            setTimeout(()=> location.href = href, 200);
          } else {
            location.href = href;
          }
        }
        card.addEventListener('click', go);
        card.addEventListener('keypress', (e)=>{ if (e.key==='Enter' || e.key===' ') { e.preventDefault(); go(); }});
      });
    })();
  </script>
</body>
</html>
